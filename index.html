<!DOCTYPE html>
<html>
<head>
	<title>Bhangra Santa Soundtrack</title>
	<link rel="stylesheet" href="index.css">
</head>
<body>
<button onclick="playRandom(basically);">Basically</button>
<button onclick="playRandom(oh_no);">Oh No!</button>
<button onclick="playRandom(ok);">Ok</button>
<button onclick="playRandom(good);">Good</button>
<button onclick="playRandom(hoy_hoy_hoy);">Hoy Hoy</button>
<button onclick="playRandom(oh_bhangra_santa);">Oh Bhangra Santa</button>
<button onclick="playRandom(uhhh);">Uhhh...</button>
<br />
<div id="pitch-div" onchange="updateSpeed();"><input type="range" min="25" max="200" value="100" class="slider" id="myRange"></div>
Speed: <span id="speed">1.0</span>x
<!-- <button>Basically</button> -->
<script type="text/javascript">
	basically = [
		new Audio('basically0.mp3'),
		new Audio('basically1.mp3'),
		new Audio('basically2.mp3'),
		new Audio('basically3.mp3'),
		new Audio('basically4.mp3')
	];

	good = [
		new Audio('good0.mp3')
	];

	hoy_hoy_hoy = [
		new Audio('hoy_hoy_hoy0.mp3'),
		new Audio('hoy_hoy_hoy1.mp3')
	];

	oh_bhangra_santa = [
		new Audio('oh_bhangra_santa0.mp3'),
		new Audio('oh_bhangra_santa1.mp3')
	];

	oh_no = [
		new Audio('oh_no0.mp3')
	];

	ok = [
		new Audio('ok0.mp3')
	];

	uhhh = [
		new Audio('uhhh0.mp3')
	];

	speed = document.querySelector("#pitch-div input");

	function playRandom(list) {
		sound = list[Math.floor((Math.random()*list.length))];
		sound.playbackRate = parseFloat(speed.value)/100;
		sound.preservePitch = false;
		sound.play();
		return;
	}

	function updateSpeed() {
		document.getElementById("speed").innerHTML = speed.value/100;
	}
	// https://stackoverflow.com/questions/25157513/javascript-pitch-shift-with-time-stretch#answer-49749868
	function playSound(file, speed=1, pitchShift=1, loop=false, autoplay=true) {
	    /*
	    Use the play() method to start the audio. if pitchShift is true
	    use the stop() method to stop the audio and destroy the object.
	    If pitchShift is false use the pause() method to pause and set
	    the attribute currentTime to 0 to reset the time.
	    */
	    if(pitchShift) {
	        /*
	        After weeks of searching, I have finally found a way to pitch shift audio.
	        Thank you Mozilla.
	        2018/03/31:
	            https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode/playbackRate
	            https://github.com/mdn/webaudio-examples/tree/master/decode-audio-data
	            https://www.w3schools.com/jsref/prop_audio_loop.asp
	        Original comments:
	            use XHR to load an audio track, and
	            decodeAudioData to decode it and stick it in a buffer.
	            Then we put the buffer into the source
	        */
	        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
	        source = audioCtx.createBufferSource();
	        request = new XMLHttpRequest();

	        request.open('GET', file, true);

	        request.responseType = 'arraybuffer';


	        request.onload = function() {
	            var audioData = request.response;

		        audioCtx.decodeAudioData(audioData, function(buffer) {
		            myBuffer = buffer;
		            songLength = buffer.duration;
		            source.buffer = myBuffer;
		            source.playbackRate.value = speed;
		            source.connect(audioCtx.destination);
		            source.loop = loop;
		        },

		        function(e){"Error with decoding audio data" + e.error});

	        }

	        request.send();
	        source.play=source.start
	    } else {
	        source=new Audio(file)
	        source.playbackRate=speed
	        source.loop=loop
	    }
	    if(autoplay) {
	        source.play()
	    }
	    return source
	}
	var source
	function play(file, pitch, speed) {
	    source=playSound('decode-audio-data/viper.ogg', pitch=2);
	}

	function stop() {
	    source.stop(0);
	    document.getElementById('play').href=''
	    document.getElementById('play').innerHTML='Refresh to play again'
	}


</script>
</body>
</html>